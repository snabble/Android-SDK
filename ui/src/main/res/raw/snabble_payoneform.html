<!doctype html>
<html>
<head>
<title>Payone Credit Card Entry</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta charset="UTF-8">
<style type="text/css">
body {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #212529;
    text-align: left;
}
form {
    width: auto;
    max-width: 1140px;
    margin: auto;
}
label {
    font-weight: bold;
    display: inline-block;
    margin-bottom: 0.5rem;
}
.form-group {
    margin-bottom: 1rem;
}
.payone-input-mock {
    border: 2px solid #07b;
    border-radius: 10px;
    padding: 5px 15px;
    max-width: 100%;
}
.payone-input-mock iframe {
    height: 50px;
    width: 100%;
    vertical-align: middle;
}
.payone-input-mock input {
    height: 42px;
    width: 100%;
    vertical-align: middle;
    font-size: 17px;
    border: none;
    outline: none;
    background-color: transparent;
}
select {
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";
    font-size: 1rem;
    font-weight: 400;
    line-height: 1.5;
    color: #212529;
    text-align: left;
    height: 42px;
    width: 100%;
    border: none;
    outline: none;
    background-color: transparent;
}
.form-group:has(select:disabled) {
    display: none;
}
#submit {
    margin: 2rem 0;
    background-color:#07b;
    border-radius: 0.3rem;
    border: none;
    padding: 0.5rem 1rem;
    padding-right: 1rem;
    padding-left: 1rem;
    font-size: 1.25rem;
    line-height: 1.5;
    color:#fff;
    width: 100%;
    font-weight: 400;
    text-align: center;
    vertical-align: middle;
}
input:focus {
  outline: none;
  box-shadow: none;
}
.halves {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}
.fifths {
    display: grid;
    grid-template-columns: 5fr 1fr;
    align-items: end;
    gap: 1rem;
}
</style>
<script type="text/javascript">
// intercept console.log
window.console.log = function(msg) {
    snabble.log(msg);
};

// intercept errors
window.onerror = function(msg, url, line, column, error) {
    const message = {
        message: msg,
        url: url,
        line: line,
        column: column,
        error: JSON.stringify(error)
    }

    console.log(message);
};

function showError(msg) {
    snabble.toast(msg)
    snabble.log(msg)
}

window.postMessage = function(a,b) {
    snabble.log(`${a}, ${b}`)
}

function processResponse(response) {
    snabble.log("processResponse for " + response.name)
    snabble.saveCard(
        response.pseudoCardPan,
        response.truncatedCardPan,
        response.cardType,
        response.cardExpiryDate,
        response.name,
        response.street,
        response.zip,
        response.city,
        response.country,
        response.state,
        response.email
    )
}
</script>
<script src="https://secure.pay1.de/client-api/js/v1/payone_hosted.js"></script>
</head>
<body>
<form action="#" method="post">
    <div class="form-group fifths">
        <div class="form-group">
            <label for="payone-cc-pan">{{cardNumberLabel}}</label>
            <div class="payone-input-mock payone-input-mock--pan">
                <!-- Mount element for PAN IFrame. -->
                <span id="payone-cc-pan"></span>
            </div>
        </div>

        <div class="form-group">
            <label for="payone-cc-cvc">{{cvcLabel}}</label>
            <div class="payone-input-mock payone-input-mock--cvc">
                <!-- Mount element for CVC IFrame. -->
                <span id="payone-cc-cvc"></span>
            </div>
        </div>
    </div>

    <div class="form-group halves">
        <div class="form-group">
            <label for="payone-cc-expire-month">{{expireMonthLabel}}</label>
            <div class="payone-input-mock payone-input-mock--expire-month">
                <!-- Mount element for card expire month IFrame. -->
                <span id="payone-cc-expire-month"></span>
            </div>
        </div>
        <div class="form-group">
            <label for="payone-cc-expire-year">{{expireYearLabel}}</label>
            <div class="payone-input-mock payone-input-mock--expire-year">
                <!-- Mount element for card expire year IFrame. -->
                <span id="payone-cc-expire-year"></span>
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="name">{{name}}</label>
        <div class="payone-input-mock">
            <input type="text" id="name" />
        </div>
    </div>

    <div class="form-group">
        <label for="street">{{street}}</label>
        <div class="payone-input-mock">
            <input type="text" id="street" />
        </div>
    </div>

    <div class="form-group halves">
        <div class="form-group">
            <label for="zip">{{zip}}</label>
            <div class="payone-input-mock">
                <input type="text" id="zip" />
            </div>
        </div>
        <div class="form-group">
            <label for="city">{{city}}</label>
            <div class="payone-input-mock">
                <input type="text" id="city" />
            </div>
        </div>
    </div>

    <div class="form-group">
        <label for="country">{{country}}</label>
        <div class="payone-input-mock">
            <select id="countrySelect" name="country" class="form-control">
                <option disabled>{{countryHint}}</option>
            </select>
        </div>
    </div>

    <div class="form-group">
        <label for="state">{{state}}</label>
        <div class="payone-input-mock">
            <select id="stateSelect" name="state" class="form-control" disabled></select>
        </div>
    </div>

    <div class="form-group">
        <label for="email">{{email}}</label>
        <div class="payone-input-mock">
            <input type="email" id="email" />
        </div>
    </div>

    <div class="form-group">
        <button id="submit" type="button">{{saveButtonLabel}}</button>
    </div>
</form>
<script type="text/javascript">
function PayoneAutoCcDetection(config) {
    console.log("PayoneAutoCcDetection " + config)
    // Apply config defaults.
    this._config = config;

    // Setup auto credit card detection config.
    console.log("supported types: " + this._config.supportedCardTypes);
    this._config.hostedIframesConfig.config.autoCardtypeDetection = {
        deactivate: false,
        supportedCardtypes: this._config.supportedCardTypes,
        callback: this._handleDetectionResult.bind(this),
    };

    // Create hosted IFrames object.
    this._hostedIframe = new Payone.ClientApi.HostedIFrames(
        this._config.hostedIframesConfig.config,
        this._config.hostedIframesConfig.request
    );

    // Register credit card check callback.
    // The hosted IFrames API expects a callback provided as string,
    // therefore we cannot use a function value reference directly.
    // As a workaround we register the actual handler method as global
    // function with a random unique name which will be provided to the
    // hosted IFrames API later.
    this._creditCardCheckCallbackName = 'payone_cc_check_callback_' + Math.random().toString().substr(2);
    window[this._creditCardCheckCallbackName] = this._creditCardCheckCallback.bind(this);
}

PayoneAutoCcDetection.prototype._handleDetectionResult = function (type) {
    console.log("handleDetection " + type);
    type = type.toUpperCase();

    // Delegate further processing to dedicated handlers.
    switch (type) {
        case '?':
            this._handleUnknownCardType(type);
            break;
        case '-':
            this._handleUnsupportedCardType(type);
            break;
        default:
            this._handleValidCardType(type);
            break;
    }
}

PayoneAutoCcDetection.prototype._handleValidCardType = function (type) {
    console.log("handleValidCard " + type);
    this._changeIcon(type);
}


PayoneAutoCcDetection.prototype._handleUnsupportedCardType = function () {
    console.log("handleUnsupportedType");
}

PayoneAutoCcDetection.prototype._creditCardCheckCallback = function (response) {
    switch (response.status) {
        case 'VALID':
            const name = document.getElementById('name').value;
            const street = document.getElementById('street').value;
            const zip = document.getElementById('zip').value;
            const city = document.getElementById('city').value;
            const country = document.getElementById('countrySelect').value;
            const state = document.getElementById('stateSelect').value;
            const email = document.getElementById('email').value;
            processResponse({
                pseudoCardPan: response.pseudocardpan,
                truncatedCardPan: response.truncatedcardpan,
                cardType: response.cardtype,
                cardExpiryDate: response.cardexpiredate,
                name: name,
                street: street,
                zip: zip,
                city: city,
                country: country,
                state: state,
                email: email
            });
            break;
        case 'INVALID':
        case 'ERROR':
            showError('Error ' + response.errorcode + ': ' + response.errormessage);
            break;
        default:
            showError('API returned an unexpected status.');
            break;
    }
}

PayoneAutoCcDetection.prototype.performCreditCardCheck = function () {
    console.log("performCheck");
    const name = document.getElementById('name').value;
    const street = document.getElementById('street').value;
    const zip = document.getElementById('zip').value;
    const city = document.getElementById('city').value;
    const countrySelect = document.getElementById('countrySelect');
    const stateSelect = document.getElementById('stateSelect');
    const email = document.getElementById('email').value;
    const stateNeeded = stateSelect.getAttribute('disabled')
    if (this._hostedIframe.isComplete() &&
        name != "" &&
        street != "" &&
        zip != "" &&
        city != "" &&
        countrySelect.selectedIndex > 0 &&
        (stateNeeded ? stateSelect.selectedIndex > 0 : true) &&
        email != ""
    ) {
        console.log("complete!");
        this._hostedIframe.creditCardCheck(this._creditCardCheckCallbackName);
    }
    else {
        console.log("incomplete :(");
        showError('{{incompleteForm}}');
    }
}

PayoneAutoCcDetection.prototype.setInitialCardType = function (type) {
    console.log("set initial card type " + type)
    this._hostedIframe.setCardType(type)
}

var autoCcDetection = new PayoneAutoCcDetection({
    supportedCardTypes: ["{{supportedCardType}}"],
    hostedIframesConfig: {
        config: {
            fields: {
                cardpan: {
                    selector: "payone-cc-pan",
                    type: "number"
                },
                cardcvc2: {
                    selector: "payone-cc-cvc",
                    type: "password",
                    size: "4",
                    maxlength: "4",
                    length: { "V": 3, "M": 3, "A": 4 }
                },
                cardexpiremonth: {
                    selector: "payone-cc-expire-month",
                    type: "number",
                    size: "2",
                    maxlength: "2"
                },
                cardexpireyear: {
                    selector: "payone-cc-expire-year",
                    size: "4",
                    maxlength: "4",
                    type: "number"
                }
            },
            defaultStyle: {
                input: "height: 100%; width: 100%; border: none; font-size: 17px; border-radius: 0; outline:none !important; box-shadow: none !important; background-color: transparent !important;",
                iframe: {}
            },

            language: Payone.ClientApi.Language.{{language}}
        },
        request: {
            "responsetype":"JSON",
            "encoding":"UTF-8",
            "mode":"{{mode}}",
            "request":"creditcardcheck",
            "storecarddata":"yes",
            "mid":"{{merchantID}}",
            "aid":"{{accountID}}",
            "portalid":"{{portalID}}",
            "hash":"{{hash}}"
        }
    },
});

document.querySelector('#submit').addEventListener('click', function (event) {
    event.preventDefault();
    console.log('click!');
    autoCcDetection.performCreditCardCheck();
});

autoCcDetection.setInitialCardType("{{supportedCardType}}");

/////////////////////////////////////////////
// Country and State (subdivision) support //
/////////////////////////////////////////////

// Source: https://docs.payone.com/pages/releaseview.action?pageId=1213959
const countries = [
    { code: "AF", label: "Afghanistan" },
    { code: "AL", label: "Albania" },
    { code: "DZ", label: "Algeria" },
    { code: "AS", label: "American Samoa" },
    { code: "AD", label: "Andorra" },
    { code: "AO", label: "Angola" },
    { code: "AI", label: "Anguilla" },
    { code: "AQ", label: "Antarctica" },
    { code: "AG", label: "Antigua And Barbuda" },
    { code: "AR", label: "Argentina" },
    { code: "AM", label: "Armenia" },
    { code: "AW", label: "Aruba" },
    { code: "AU", label: "Australia" },
    { code: "AT", label: "Austria" },
    { code: "AZ", label: "Azerbaijan" },
    { code: "BS", label: "Bahamas" },
    { code: "BH", label: "Bahrain" },
    { code: "BD", label: "Bangladesh" },
    { code: "BB", label: "Barbados" },
    { code: "BY", label: "Belarus" },
    { code: "BE", label: "Belgium" },
    { code: "BZ", label: "Belize" },
    { code: "BJ", label: "Benin" },
    { code: "BM", label: "Bermuda" },
    { code: "BT", label: "Bhutan" },
    { code: "BO", label: "Bolivia" },
    { code: "BA", label: "Bosnia And Herzegowina (Herzegowina)" },
    { code: "BW", label: "Botswana" },
    { code: "BV", label: "Bouvet Island" },
    { code: "BR", label: "Brazil" },
    { code: "IO", label: "British Indian Ocean Territory" },
    { code: "BN", label: "Brunei Darussalam" },
    { code: "BG", label: "Bulgaria" },
    { code: "BF", label: "Burkina Faso" },
    { code: "BI", label: "Burundi" },
    { code: "KH", label: "Cambodia" },
    { code: "CM", label: "Cameroon" },
    { code: "CA", label: "Canada" },
    { code: "CV", label: "Cape Verde" },
    { code: "KY", label: "Cayman Islands" },
    { code: "CF", label: "Central African Republic" },
    { code: "TD", label: "Chad" },
    { code: "CL", label: "Chile" },
    { code: "CN", label: "China" },
    { code: "CX", label: "Christmas Island" },
    { code: "CC", label: "Cocos (Keeling) Islands" },
    { code: "CO", label: "Colombia" },
    { code: "KM", label: "Comoros" },
    { code: "CG", label: "Congo" },
    { code: "CK", label: "Cook Islands" },
    { code: "CR", label: "Costa Rica" },
    { code: "CI", label: "Cote d'Ivoire" },
    { code: "HR", label: "Croatia (local name: Hrvatska)" },
    { code: "CU", label: "Cuba" },
    { code: "CY", label: "Cyprus" },
    { code: "CZ", label: "Czech Republic" },
    { code: "DK", label: "Denmark" },
    { code: "DJ", label: "Djibouti" },
    { code: "DM", label: "Dominica" },
    { code: "DO", label: "Dominican Republic" },
    { code: "TP", label: "East Timor" },
    { code: "EC", label: "Ecuador" },
    { code: "EG", label: "Egypt" },
    { code: "SV", label: "El Salvador" },
    { code: "GQ", label: "Equatorial Guinea" },
    { code: "ER", label: "Eritrea" },
    { code: "EE", label: "Estonia" },
    { code: "ET", label: "Ethiopia" },
    { code: "EU", label: "Europe (SSGFI only)" },
    { code: "FK", label: "Falkland Islands (Malvinas)" },
    { code: "FO", label: "Faroe Islands" },
    { code: "FJ", label: "Fiji" },
    { code: "FI", label: "Finland" },
    { code: "FR", label: "France" },
    { code: "FX", label: "France, Metropolitan" },
    { code: "GF", label: "French Guiana" },
    { code: "PF", label: "French Polynesia" },
    { code: "TF", label: "French Southern Territories" },
    { code: "GA", label: "Gabon" },
    { code: "GM", label: "Gambia" },
    { code: "GE", label: "Georgia" },
    { code: "DE", label: "Germany" },
    { code: "GH", label: "Ghana" },
    { code: "GI", label: "Gibraltar" },
    { code: "GR", label: "Greece" },
    { code: "GL", label: "Greenland" },
    { code: "GD", label: "Grenada" },
    { code: "GP", label: "Guadeloupe" },
    { code: "GU", label: "Guam" },
    { code: "GT", label: "Guatemala" },
    { code: "GN", label: "Guinea" },
    { code: "GW", label: "Guinea-Bissau" },
    { code: "GY", label: "Guyana" },
    { code: "HT", label: "Haiti" },
    { code: "HM", label: "Heard And Mc Donald Islands" },
    { code: "HN", label: "Honduras" },
    { code: "HK", label: "Hong Kong" },
    { code: "HU", label: "Hungary" },
    { code: "IS", label: "Iceland" },
    { code: "IN", label: "India" },
    { code: "ID", label: "Indonesia" },
    { code: "II", label: "International (SSGFI only)" },
    { code: "IR", label: "Iran (Islamic Republic Of)" },
    { code: "IQ", label: "Iraq" },
    { code: "IE", label: "Ireland" },
    { code: "IL", label: "Israel" },
    { code: "IT", label: "Italy" },
    { code: "JM", label: "Jamaica" },
    { code: "JP", label: "Japan" },
    { code: "JO", label: "Jordan" },
    { code: "KZ", label: "Kazakhstan" },
    { code: "KE", label: "Kenya" },
    { code: "KI", label: "Kiribati" },
    { code: "KP", label: "Korea, Democratic People's Republic Of" },
    { code: "KR", label: "Korea, Republic Of" },
    { code: "KW", label: "Kuwait" },
    { code: "KG", label: "Kyrgyzstan" },
    { code: "LA", label: "Lao People's Democratic Republic" },
    { code: "LV", label: "Latvia" },
    { code: "LB", label: "Lebanon" },
    { code: "LS", label: "Lesotho" },
    { code: "LR", label: "Liberia" },
    { code: "LY", label: "Libyan Arab Jamahiriya" },
    { code: "LI", label: "Liechtenstein" },
    { code: "LT", label: "Lithuania" },
    { code: "LU", label: "Luxembourg" },
    { code: "MO", label: "Macau" },
    { code: "MG", label: "Madagascar" },
    { code: "MW", label: "Malawi" },
    { code: "MY", label: "Malaysia" },
    { code: "MV", label: "Maldives" },
    { code: "ML", label: "Mali" },
    { code: "MT", label: "Malta" },
    { code: "MH", label: "Marshall Islands" },
    { code: "MQ", label: "Martinique" },
    { code: "MR", label: "Mauritania" },
    { code: "MU", label: "Mauritius" },
    { code: "YT", label: "Mayotte" },
    { code: "MX", label: "Mexico" },
    { code: "FM", label: "Micronesia, Federated States Of" },
    { code: "MD", label: "Moldova, Republic Of" },
    { code: "MC", label: "Monaco" },
    { code: "MN", label: "Mongolia" },
    { code: "MS", label: "Montserrat" },
    { code: "MA", label: "Morocco" },
    { code: "MZ", label: "Mozambique" },
    { code: "MM", label: "Myanmar" },
    { code: "NA", label: "Namibia" },
    { code: "NR", label: "Nauru" },
    { code: "NP", label: "Nepal" },
    { code: "NL", label: "Netherlands" },
    { code: "AN", label: "Netherlands Antilles" },
    { code: "NC", label: "New Caledonia" },
    { code: "NZ", label: "New Zealand" },
    { code: "NI", label: "Nicaragua" },
    { code: "NE", label: "Niger" },
    { code: "NG", label: "Nigeria" },
    { code: "NU", label: "Niue" },
    { code: "NF", label: "Norfolk Island" },
    { code: "MP", label: "Northern Mariana Islands" },
    { code: "NO", label: "Norway" },
    { code: "OM", label: "Oman" },
    { code: "PK", label: "Pakistan" },
    { code: "PW", label: "Palau" },
    { code: "PA", label: "Panama" },
    { code: "PG", label: "Papua New Guinea" },
    { code: "PY", label: "Paraguay" },
    { code: "PE", label: "Peru" },
    { code: "PH", label: "Philippines" },
    { code: "PN", label: "Pitcairn" },
    { code: "PL", label: "Poland" },
    { code: "PT", label: "Portugal" },
    { code: "PR", label: "Puerto Rico" },
    { code: "QA", label: "Qatar" },
    { code: "MK", label: "Republic Of Macedonia (The Former Yugoslav)" },
    { code: "RE", label: "Reunion" },
    { code: "RO", label: "Romania" },
    { code: "RU", label: "Russian Federation" },
    { code: "RW", label: "Rwanda" },
    { code: "KN", label: "Saint Kitts And Nevis" },
    { code: "LC", label: "Saint Lucia" },
    { code: "VC", label: "Saint Vincent And The Grenadines" },
    { code: "WS", label: "Samoa" },
    { code: "SM", label: "San Marino" },
    { code: "ST", label: "Sao Tome And Principe" },
    { code: "SA", label: "Saudi Arabia" },
    { code: "SN", label: "Senegal" },
    { code: "SC", label: "Seychelles" },
    { code: "SL", label: "Sierra Leone" },
    { code: "SG", label: "Singapore" },
    { code: "SK", label: "Slovakia (Slovak Republic)" },
    { code: "SI", label: "Slovenia" },
    { code: "SB", label: "Solomon Islands" },
    { code: "SO", label: "Somalia" },
    { code: "ZA", label: "South Africa" },
    { code: "GS", label: "South Georgia And The South Sandwich Islands" },
    { code: "ES", label: "Spain" },
    { code: "LK", label: "Sri Lanka" },
    { code: "SH", label: "St. Helena" },
    { code: "PM", label: "St. Pierre And Miquelon" },
    { code: "SD", label: "Sudan" },
    { code: "SR", label: "Suriname" },
    { code: "SJ", label: "Svalbard And Jan Mayen Islands" },
    { code: "SZ", label: "Swaziland" },
    { code: "SE", label: "Sweden" },
    { code: "CH", label: "Switzerland" },
    { code: "SY", label: "Syrian Arab Republic" },
    { code: "TW", label: "Taiwan, Province Of China" },
    { code: "TJ", label: "Tajikistan" },
    { code: "TZ", label: "Tanzania, United Republic Of" },
    { code: "TH", label: "Thailand" },
    { code: "TG", label: "Togo" },
    { code: "TK", label: "Tokelau" },
    { code: "TO", label: "Tonga" },
    { code: "TT", label: "Trinidad And Tobago" },
    { code: "TN", label: "Tunisia" },
    { code: "TR", label: "Turkey" },
    { code: "TM", label: "Turkmenistan" },
    { code: "TC", label: "Turks And Caicos Islands" },
    { code: "TV", label: "Tuvalu" },
    { code: "UG", label: "Uganda" },
    { code: "UA", label: "Ukraine" },
    { code: "AE", label: "United Arab Emirates" },
    { code: "GB", label: "United Kingdom (UK)" },
    { code: "US", label: "United States" },
    { code: "UM", label: "United States Minor Outlying Islands" },
    { code: "UY", label: "Uruguay" },
    { code: "UZ", label: "Uzbekistan" },
    { code: "VU", label: "Vanuatu" },
    { code: "VA", label: "Vatican City State (Holy See)" },
    { code: "VE", label: "Venezuela" },
    { code: "VN", label: "Vietnam" },
    { code: "VG", label: "Virgin Islands (British)" },
    { code: "VI", label: "Virgin Islands (U.S.)" },
    { code: "WF", label: "Wallis And Futuna Islands" },
    { code: "EH", label: "Western Sahara" },
    { code: "YE", label: "Yemen" },
    { code: "YU", label: "Yugoslavia" },
    { code: "ZR", label: "Zaire" },
    { code: "ZM", label: "Zambia" },
    { code: "ZW", label: "Zimbabwe" },
];

// Source: https://docs.payone.com/pages/releaseview.action?pageId=1213957
const subdivisions = {
    US: [
        { code: "AL", label: "Alabama" },
        { code: "AK", label: "Alaska" },
        { code: "AS", label: "American Samoa" },
        { code: "AZ", label: "Arizona" },
        { code: "AR", label: "Arkansas" },
        { code: "CA", label: "California" },
        { code: "CO", label: "Colorado" },
        { code: "CT", label: "Connecticut" },
        { code: "DE", label: "Delaware" },
        { code: "DC", label: "District of Columbia" },
        { code: "FL", label: "Florida" },
        { code: "GA", label: "Georgia" },
        { code: "GU", label: "Guam" },
        { code: "HI", label: "Hawaii" },
        { code: "ID", label: "Idaho" },
        { code: "IL", label: "Illinois" },
        { code: "IN", label: "Indiana" },
        { code: "IA", label: "Iowa" },
        { code: "KS", label: "Kansas" },
        { code: "KY", label: "Kentucky" },
        { code: "LA", label: "Louisiana" },
        { code: "ME", label: "Maine" },
        { code: "MD", label: "Maryland" },
        { code: "MA", label: "Massachusetts" },
        { code: "MI", label: "Michigan" },
        { code: "MN", label: "Minnesota" },
        { code: "MS", label: "Mississippi" },
        { code: "MO", label: "Missouri" },
        { code: "MT", label: "Montana" },
        { code: "NE", label: "Nebraska" },
        { code: "NV", label: "Nevada" },
        { code: "NH", label: "New Hampshire" },
        { code: "NJ", label: "New Jersey" },
        { code: "NM", label: "New Mexico" },
        { code: "NY", label: "New York" },
        { code: "NC", label: "North Carolina" },
        { code: "ND", label: "North Dakota" },
        { code: "MP", label: "Northern Mariana Islands" },
        { code: "OH", label: "Ohio" },
        { code: "OK", label: "Oklahoma" },
        { code: "OR", label: "Oregon" },
        { code: "PA", label: "Pennsylvania" },
        { code: "PR", label: "Puerto Rico" },
        { code: "RI", label: "Rhode Island" },
        { code: "SC", label: "South Carolina" },
        { code: "SD", label: "South Dakota" },
        { code: "TN", label: "Tennessee" },
        { code: "TX", label: "Texas" },
        { code: "UM", label: "United States Minor" },
        { code: "UT", label: "Utah" },
        { code: "VT", label: "Vermont" },
        { code: "VI", label: "Virgin Islands, U.S." },
        { code: "VA", label: "Virginia" },
        { code: "WA", label: "Washington" },
        { code: "WV", label: "West Virginia" },
        { code: "WI", label: "Wisconsin" },
        { code: "WY", label: "Wyoming" },
    ],
    CA: [
        { code: "AB", label: "Alberta" },
        { code: "BC", label: "British Columbia" },
        { code: "MB", label: "Manitoba" },
        { code: "NB", label: "New Brunswick" },
        { code: "NL", label: "Newfoundland and Labrador" },
        { code: "NT", label: "Northwest Territories" },
        { code: "NS", label: "Nova Scotia" },
        { code: "NU", label: "Nunavut" },
        { code: "ON", label: "Ontario" },
        { code: "PE", label: "Prince Edward Island" },
        { code: "QC", label: "Quebec" },
        { code: "SK", label: "Saskatchewan" },
        { code: "YT", label: "Yukon" },
    ],
    MX: [
        { code: "AGU", label: "Aguascalientes" },
        { code: "BCN", label: "Baja California" },
        { code: "BCS", label: "Baja California Sur" },
        { code: "CAM", label: "Campeche" },
        { code: "CHP", label: "Chiapas" },
        { code: "CHH", label: "Chihuahua" },
        { code: "COA", label: "Coahuila" },
        { code: "COL", label: "Colima" },
        { code: "DIF", label: "Distrito Federal" },
        { code: "DUR", label: "Durango" },
        { code: "GUA", label: "Guanajuato" },
        { code: "GRO", label: "Guerrero" },
        { code: "HID", label: "Hidalgo" },
        { code: "JAL", label: "Jalisco" },
        { code: "MIC", label: "Michoacán" },
        { code: "MOR", label: "Morelos" },
        { code: "MEX", label: "México" },
        { code: "NAY", label: "Nayarit" },
        { code: "NLE", label: "Nuevo León" },
        { code: "OAX", label: "Oaxaca" },
        { code: "PUE", label: "Puebla" },
        { code: "QUE", label: "Querétaro" },
        { code: "ROO", label: "Quintana Roo" },
        { code: "SLP", label: "San Luis Potosí" },
        { code: "SIN", label: "Sinaloa" },
        { code: "SON", label: "Sonora" },
        { code: "TAB", label: "Tabasco" },
        { code: "TAM", label: "Tamaulipas" },
        { code: "TLA", label: "Tlaxcala" },
        { code: "VER", label: "Veracruz" },
        { code: "YUC", label: "Yucatán" },
        { code: "ZAC", label: "Zacatecas" },
    ],
    AR: [
        { code: "B", label: "Buenos Aires" },
        { code: "K", label: "Catamarca" },
        { code: "H", label: "Chaco" },
        { code: "U", label: "Chubut" },
        { code: "C", label: "Ciudad Autónoma de Buenos Aires" },
        { code: "W", label: "Corrientes" },
        { code: "X", label: "Córdoba" },
        { code: "E", label: "Entre Ríos" },
        { code: "P", label: "Formosa" },
        { code: "Y", label: "Jujuy" },
        { code: "L", label: "La Pampa" },
        { code: "F", label: "La Rioja" },
        { code: "M", label: "Mendoza" },
        { code: "N", label: "Misiones" },
        { code: "Q", label: "Neuquén" },
        { code: "R", label: "Río Negro" },
        { code: "A", label: "Salta" },
        { code: "J", label: "San Juan" },
        { code: "D", label: "San Luis" },
        { code: "Z", label: "Santa Cruz" },
        { code: "S", label: "Santa Fe" },
        { code: "G", label: "Santiago del Estero" },
        { code: "V", label: "Tierra del Fuego" },
        { code: "T", label: "Tucumán" },
    ],
    BR: [
        { code: "AC", label: "Acre" },
        { code: "AL", label: "Alagoas" },
        { code: "AP", label: "Amapá" },
        { code: "AM", label: "Amazonas" },
        { code: "BA", label: "Bahia" },
        { code: "CE", label: "Ceará" },
        { code: "DF", label: "Distrito Federal" },
        { code: "ES", label: "Espírito Santo" },
        { code: "GO", label: "Goiás" },
        { code: "MA", label: "Maranhão" },
        { code: "MT", label: "Mato Grosso" },
        { code: "MS", label: "Mato Grosso do Sul" },
        { code: "MG", label: "Minas Gerais" },
        { code: "PR", label: "Paraná" },
        { code: "PB", label: "Paraíba" },
        { code: "PA", label: "Pará" },
        { code: "PE", label: "Pernambuco" },
        { code: "PI", label: "Piauí" },
        { code: "RN", label: "Rio Grande do Norte" },
        { code: "RS", label: "Rio Grande do Sul" },
        { code: "RJ", label: "Rio de Janeiro" },
        { code: "RO", label: "Rondônia" },
        { code: "RR", label: "Roraima" },
        { code: "SC", label: "Santa Catarina" },
        { code: "SE", label: "Sergipe" },
        { code: "SP", label: "São Paulo" },
        { code: "TO", label: "Tocantins" },
    ],
    CN: [
        { code:"11", label: "Beijing" },
        { code:"43", label: "Hunan" },
        { code:"12", label: "Tianjin" },
        { code:"44", label: "Guangdong" },
        { code:"13", label: "Hebei" },
        { code:"45", label: "Guangxi" },
        { code:"14", label: "Shanxi" },
        { code:"46", label: "Hainan" },
        { code:"15", label: "Nei Mongol (mn), (Inner Mongolia)" },
        { code:"50", label: "Chongqing" },
        { code:"21", label: "Liaoning" },
        { code:"51", label: "Sichuan" },
        { code:"22", label: "Jilin" },
        { code:"52", label: "Guizhou" },
        { code:"23", label: "Heilongjiang" },
        { code:"53", label: "Yunnan" },
        { code:"31", label: "Shanghai" },
        { code:"54", label: "Xizang (Tibet)" },
        { code:"32", label: "Jiangsu" },
        { code:"61", label: "Shaanxi" },
        { code:"33", label: "Zhejiang" },
        { code:"62", label: "Gansu" },
        { code:"34", label: "Anhui" },
        { code:"63", label: "Qinghai" },
        { code:"35", label: "Fujian" },
        { code:"64", label: "Ningxia" },
        { code:"36", label: "Jiangxi" },
        { code:"65", label: "Xinjiang" },
        { code:"37", label: "Shandong" },
        { code:"71", label: "Taiwan" },
        { code:"41", label: "Henan" },
        { code:"91", label: "Hong Kong (en) Xianggang (zh)" },
        { code:"42", label: "Hubei" },
        { code:"92", label: "Macao (en) Aomen (zh)" },
    ],
    ID: [
        { code: "AC", label: "Aceh, Aceh" },
        { code: "BA", label: "Bali, Bali" },
        { code: "BB", label: "Bangka Belitung, Bangka-Belitung Islands" },
        { code: "BT", label: "Banten, Banten" },
        { code: "BE", label: "Bengkulu, Bengkulu" },
        { code: "GO", label: "Gorontalo, Gorontalo" },
        { code: "JK", label: "Jakarta Raya, Jakarta" },
        { code: "JA", label: "Jambi, Jambi" },
        { code: "JB", label: "Jawa Barat, West Java" },
        { code: "JT", label: "Jawa Tengah, Central Java" },
        { code: "JI", label: "Jawa Timur, East Java" },
        { code: "KB", label: "Kalimantan Baratm, West Kalimantan" },
        { code: "KS", label: "Kalimantan Selatan, South Kalimantan" },
        { code: "KT", label: "Kalimantan Tengah, Central Kalimantan" },
        { code: "KI", label: "Kalimantan Timur, East Kalimantan" },
        { code: "KU", label: "Kalimantan Utara, North Kalimantan" },
        { code: "KR", label: "Kepulauan Riau, Riau Islands" },
        { code: "LA", label: "Lampung, Lampung" },
        { code: "MU", label: "Maluku Utara, North Maluku" },
        { code: "MA", label: "Maluku, Maluku" },
        { code: "NB", label: "Nusa Tenggara Barat, West Nusa Tenggara" },
        { code: "NT", label: "Nusa Tenggara Timur, East Nusa Tenggara" },
        { code: "PB", label: "Papua Barat, West Papua" },
        { code: "PA", label: "Papua, Papua" },
        { code: "RI", label: "Riau, Riau" },
        { code: "SR", label: "Sulawesi Barat, West Sulawesi" },
        { code: "SN", label: "Sulawesi Selatan, South Sulawesi" },
        { code: "ST", label: "Sulawesi Tengah, Central Sulawesi" },
        { code: "SG", label: "Sulawesi Tenggara, Southeast Sulawesi" },
        { code: "SA", label: "Sulawesi Utara, North Sulawesi" },
        { code: "SB", label: "Sumatera Barat, West Sumatra" },
        { code: "SS", label: "Sumatera Selatan, South Sumatra" },
        { code: "SU", label: "Sumatera Utara, North Sumatra" },
        { code: "YO", label: "Yogyakarta, Yogyakarta" },
    ],
    IN: [
        { code: "AN", label: "Andaman and Nicobar Islands" },
        { code: "AP", label: "Andhra Pradesh" },
        { code: "AR", label: "Arunachal Pradesh" },
        { code: "AS", label: "Assam" },
        { code: "BR", label: "Bihar" },
        { code: "CH", label: "Chandigarh" },
        { code: "CT", label: "Chhattisgarh" },
        { code: "DN", label: "Dadra and Nagar Haveli" },
        { code: "DD", label: "Daman and Diu" },
        { code: "DL", label: "Delhi" },
        { code: "GA", label: "Goa" },
        { code: "GJ", label: "Gujarat" },
        { code: "HR", label: "Haryana" },
        { code: "HP", label: "Himachal Pradesh" },
        { code: "JK", label: "Jammu and Kashmir" },
        { code: "JH", label: "Jharkhand" },
        { code: "KA", label: "Karnataka" },
        { code: "KL", label: "Kerala" },
        { code: "LD", label: "Lakshadweep" },
        { code: "MP", label: "Madhya Pradesh" },
        { code: "MH", label: "Maharashtra" },
        { code: "MN", label: "Manipur" },
        { code: "ML", label: "Meghalaya" },
        { code: "MZ", label: "Mizoram" },
        { code: "NL", label: "Nagaland" },
        { code: "OR", label: "Odisha" },
        { code: "PY", label: "Puducherry" },
        { code: "PB", label: "Punjab" },
        { code: "RJ", label: "Rajasthan" },
        { code: "SK", label: "Sikkim" },
        { code: "TN", label: "Tamil Nadu" },
        { code: "TG", label: "Telangana" },
        { code: "TR", label: "Tripura" },
        { code: "UP", label: "Uttar Pradesh" },
        { code: "UT", label: "Uttarakhand" },
        { code: "WB", label: "West Bengal" },
    ],
    JP: [
        { code: "23", label: "Aiti (Aichi)" },
        { code: "05", label: "Akita" },
        { code: "02", label: "Aomori" },
        { code: "38", label: "Ehime" },
        { code: "21", label: "Gihu (Gifu)" },
        { code: "10", label: "Gunma" },
        { code: "34", label: "Hirosima (Hiroshima)" },
        { code: "01", label: "Hokkaidô (Hokkaido)" },
        { code: "18", label: "Hukui (Fukui)" },
        { code: "40", label: "Hukuoka (Fukuoka)" },
        { code: "07", label: "Hukusima (Fukushima)" },
        { code: "28", label: "Hyôgo (Hyogo)" },
        { code: "08", label: "Ibaraki" },
        { code: "17", label: "Isikawa (Ishikawa)" },
        { code: "03", label: "Iwate" },
        { code: "37", label: "Kagawa" },
        { code: "46", label: "Kagosima (Kagoshima)" },
        { code: "14", label: "Kanagawa" },
        { code: "43", label: "Kumamoto" },
        { code: "26", label: "Kyôto (Kyoto)" },
        { code: "39", label: "Kôti (Kochi)" },
        { code: "24", label: "Mie" },
        { code: "04", label: "Miyagi" },
        { code: "45", label: "Miyazaki" },
        { code: "20", label: "Nagano" },
        { code: "42", label: "Nagasaki" },
        { code: "29", label: "Nara" },
        { code: "15", label: "Niigata" },
        { code: "33", label: "Okayama" },
        { code: "47", label: "Okinawa" },
        { code: "41", label: "Saga" },
        { code: "11", label: "Saitama" },
        { code: "25", label: "Siga (Shiga)" },
        { code: "32", label: "Simane (Shimane)" },
        { code: "22", label: "Sizuoka (Shizuoka)" },
        { code: "12", label: "Tiba (Chiba)" },
        { code: "36", label: "Tokusima (Tokushima)" },
        { code: "09", label: "Totigi (Tochigi)" },
        { code: "31", label: "Tottori" },
        { code: "16", label: "Toyama" },
        { code: "13", label: "Tôkyô (Tokyo)" },
        { code: "30", label: "Wakayama" },
        { code: "06", label: "Yamagata" },
        { code: "35", label: "Yamaguti (Yamaguchi)" },
        { code: "19", label: "Yamanasi (Yamanashi)" },
        { code: "44", label: "Ôita (Oita)" },
        { code: "27", label: "Ôsaka (Osaka)" },
    ],
    TH: [
        { code: "37", label: "Amnat Charoen" },
        { code: "15", label: "Ang Thong" },
        { code: "38", label: "Bueng Kan" },
        { code: "31", label: "Buri Ram" },
        { code: "24", label: "Chachoengsao" },
        { code: "18", label: "Chai Nat" },
        { code: "36", label: "Chaiyaphum" },
        { code: "22", label: "Chanthaburi" },
        { code: "50", label: "Chiang Mai" },
        { code: "57", label: "Chiang Rai" },
        { code: "20", label: "Chon Buri" },
        { code: "86", label: "Chumphon" },
        { code: "46", label: "Kalasin" },
        { code: "62", label: "Kamphaeng Phet" },
        { code: "71", label: "Kanchanaburi" },
        { code: "40", label: "Khon Kaen" },
        { code: "81", label: "Krabi" },
        { code: "10", label: "Krung Thep Maha Nakhon [Bangkok]" },
        { code: "52", label: "Lampang" },
        { code: "51", label: "Lamphun" },
        { code: "42", label: "Loei" },
        { code: "16", label: "Lop Buri" },
        { code: "58", label: "Mae Hong Son" },
        { code: "44", label: "Maha Sarakham" },
        { code: "49", label: "Mukdahan" },
        { code: "26", label: "Nakhon Nayok" },
        { code: "73", label: "Nakhon Pathom" },
        { code: "48", label: "Nakhon Phanom" },
        { code: "30", label: "Nakhon Ratchasima" },
        { code: "60", label: "Nakhon Sawan" },
        { code: "80", label: "Nakhon Si Thammarat" },
        { code: "55", label: "Nan" },
        { code: "96", label: "Narathiwat" },
        { code: "39", label: "Nong Bua Lam Phu" },
        { code: "43", label: "Nong Khai" },
        { code: "12", label: "Nonthaburi" },
        { code: "13", label: "Pathum Thani" },
        { code: "94", label: "Pattani" },
        { code: "82", label: "Phangnga" },
        { code: "93", label: "Phatthalung" },
        { code: "S",  label: "Phatthaya" },
        { code: "56", label: "Phayao" },
        { code: "67", label: "Phetchabun" },
        { code: "76", label: "Phetchaburi" },
        { code: "66", label: "Phichit" },
        { code: "65", label: "Phitsanulok" },
        { code: "14", label: "Phra Nakhon Si Ayutthaya" },
        { code: "54", label: "Phrae" },
        { code: "83", label: "Phuket" },
        { code: "25", label: "Prachin Buri" },
        { code: "77", label: "Prachuap Khiri Khan" },
        { code: "85", label: "Ranong" },
        { code: "70", label: "Ratchaburi" },
        { code: "21", label: "Rayong" },
        { code: "45", label: "Roi Et" },
        { code: "27", label: "Sa Kaeo" },
        { code: "47", label: "Sakon Nakhon" },
        { code: "11", label: "Samut Prakan" },
        { code: "74", label: "Samut Sakhon" },
        { code: "75", label: "Samut Songkhram" },
        { code: "19", label: "Saraburi" },
        { code: "91", label: "Satun" },
        { code: "33", label: "Si Sa Ket" },
        { code: "17", label: "Sing Buri" },
        { code: "90", label: "Songkhla" },
        { code: "64", label: "Sukhothai" },
        { code: "72", label: "Suphan Buri" },
        { code: "84", label: "Surat Thani" },
        { code: "32", label: "Surin" },
        { code: "63", label: "Tak" },
        { code: "92", label: "Trang" },
        { code: "23", label: "Trat" },
        { code: "34", label: "Ubon Ratchathani" },
        { code: "41", label: "Udon Thani" },
        { code: "61", label: "Uthai Thani" },
        { code: "53", label: "Uttaradit" },
        { code: "95", label: "Yala" },
        { code: "35", label: "Yasothon" },
    ]
}

function handleCountrySelect(countryCode) {
    const stateSelect = document.getElementById('stateSelect')
    stateSelect.replaceChildren()
    stateSelect.disabled = !subdivisions[countryCode]

    if (!subdivisions[countryCode]) return

    const option = document.createElement('option')
    option.textContent = '{{stateHint}}'
    option.disabled = true
    stateSelect.appendChild(option)

    subdivisions[countryCode].forEach(state => {
        const option = document.createElement('option')
        option.value = state.code
        option.textContent = state.label
        stateSelect.appendChild(option)
    })

    stateSelect.selectedIndex = 0
}

function countryOptions() {
    const select = document.getElementById('countrySelect');
    countries.forEach(country => {
        const option = document.createElement('option');
        option.value = country.code;
        option.textContent = country.label;
        select.appendChild(option);
    })

    select.addEventListener('change', function() { handleCountrySelect(this.value); });

    const localeCountryCode = '{{localeCountryCode}}'
    select.selectedIndex = countries.findIndex(country => country.code == localeCountryCode) + 1
    handleCountrySelect(localeCountryCode);
}
countryOptions();
</script>
</body>
</html>
